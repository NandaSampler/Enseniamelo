{"openapi":"3.1.0","info":{"title":"Payments Service (Mock)","version":"1.0.0"},"paths":{"/health":{"get":{"tags":["meta"],"summary":"Health","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/v1/planes/":{"get":{"tags":["planes"],"summary":"Listar planes","description":"Devuelve todos los planes disponibles (mock, en memoria).","operationId":"list_plans_v1_planes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/PlanOut"},"type":"array","title":"Response List Plans V1 Planes  Get"}}}}}},"post":{"tags":["planes"],"summary":"Crear un plan","description":"Crea un nuevo plan con nombre único, precio y duración.","operationId":"create_plan_v1_planes__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PlanCreate"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PlanOut"}}}},"409":{"description":"Conflicto (plan ya existe).","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Error de validación.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/v1/planes/{pid}":{"put":{"tags":["planes"],"summary":"Actualizar plan","description":"Actualiza los campos del plan indicado.","operationId":"update_plan_v1_planes__pid__put","parameters":[{"name":"pid","in":"path","required":true,"schema":{"type":"string","title":"Pid"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PlanUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PlanOut"}}}},"404":{"description":"Plan no encontrado.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Error de validación.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}},"delete":{"tags":["planes"],"summary":"Eliminar plan","description":"Elimina el plan si **no** está referenciado por suscripciones.","operationId":"delete_plan_v1_planes__pid__delete","parameters":[{"name":"pid","in":"path","required":true,"schema":{"type":"string","title":"Pid"}}],"responses":{"204":{"description":"Eliminado."},"404":{"description":"Plan no encontrado.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"409":{"description":"Plan en uso por suscripciones.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/suscripciones/":{"get":{"tags":["suscripciones"],"summary":"Listar suscripciones","description":"Devuelve suscripciones. Permite filtrar por `user_id`, `plan_id` y `estado`.","operationId":"list_subscriptions_v1_suscripciones__get","parameters":[{"name":"user_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrar por usuario externo.","title":"User Id"},"description":"Filtrar por usuario externo."},{"name":"plan_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrar por ID de plan.","title":"Plan Id"},"description":"Filtrar por ID de plan."},{"name":"estado","in":"query","required":false,"schema":{"anyOf":[{"enum":["pendiente","activa","expirada","cancelada"],"type":"string"},{"type":"null"}],"description":"Filtrar por estado.","title":"Estado"},"description":"Filtrar por estado."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/SubsOut"},"title":"Response List Subscriptions V1 Suscripciones  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["suscripciones"],"summary":"Crear suscripción","description":"Crea una suscripción **pendiente** basada en un plan existente. Calcula `fin_iso = inicio_iso + duracion(plan)`.","operationId":"create_subscription_v1_suscripciones__post","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SubsCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SubsOut"}}}},"404":{"description":"Plan no encontrado.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Error de validación.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/v1/suscripciones/{sid}":{"get":{"tags":["suscripciones"],"summary":"Obtener suscripción por ID","operationId":"get_subscription_v1_suscripciones__sid__get","parameters":[{"name":"sid","in":"path","required":true,"schema":{"type":"string","title":"Sid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SubsOut"}}}},"404":{"description":"Suscripción no encontrada.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"put":{"tags":["suscripciones"],"summary":"Actualizar suscripción","description":"Permite cambiar `plan_id` o `inicio_iso` (recalcula `fin_iso`). Cambio de `estado` solo a **cancelada**.","operationId":"update_subscription_v1_suscripciones__sid__put","parameters":[{"name":"sid","in":"path","required":true,"schema":{"type":"string","title":"Sid"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SubsUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SubsOut"}}}},"404":{"description":"Suscripción/Plan no encontrado.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"409":{"description":"Transición de estado no permitida.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Error de validación.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}},"delete":{"tags":["suscripciones"],"summary":"Eliminar suscripción","description":"Elimina la suscripción si **no** tiene pagos asociados.","operationId":"delete_subscription_v1_suscripciones__sid__delete","parameters":[{"name":"sid","in":"path","required":true,"schema":{"type":"string","title":"Sid"}}],"responses":{"204":{"description":"Eliminada."},"404":{"description":"Suscripción no encontrada.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"409":{"description":"Tiene pagos asociados.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/pagos/":{"get":{"tags":["pagos"],"summary":"Listar pagos","description":"Devuelve pagos. Permite filtrar por `suscripcion_id`, `estado` y `metodo`.","operationId":"list_payments_v1_pagos__get","parameters":[{"name":"suscripcion_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrar por ID de suscripción.","title":"Suscripcion Id"},"description":"Filtrar por ID de suscripción."},{"name":"estado","in":"query","required":false,"schema":{"anyOf":[{"enum":["creado","procesando","exitoso","fallido","reembolsado"],"type":"string"},{"type":"null"}],"description":"Filtrar por estado.","title":"Estado"},"description":"Filtrar por estado."},{"name":"metodo","in":"query","required":false,"schema":{"anyOf":[{"enum":["tarjeta","transferencia","stripe_simulado"],"type":"string"},{"type":"null"}],"description":"Filtrar por método.","title":"Metodo"},"description":"Filtrar por método."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/PagoOut"},"title":"Response List Payments V1 Pagos  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["pagos"],"summary":"Crear pago","description":"Crea un pago en estado `creado`. Uso recomendado de cabecera **X-Idempotency-Key** para evitar duplicados.","operationId":"create_payment_v1_pagos__post","parameters":[{"name":"x-idempotency-key","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Clave opcional para idempotencia. Si se repite, retorna el mismo resultado previo.","title":"X-Idempotency-Key"},"description":"Clave opcional para idempotencia. Si se repite, retorna el mismo resultado previo."}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PagoCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PagoOut"}}}},"404":{"description":"Suscripción no encontrada.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Error de validación.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/v1/pagos/{pid}":{"get":{"tags":["pagos"],"summary":"Obtener pago por ID","operationId":"get_payment_v1_pagos__pid__get","parameters":[{"name":"pid","in":"path","required":true,"schema":{"type":"string","title":"Pid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PagoOut"}}}},"404":{"description":"Pago no encontrado.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"put":{"tags":["pagos"],"summary":"Actualizar pago","description":"Permite actualizar `estado` y/o `provider_ref`. Si `estado` pasa a `exitoso`, la suscripción asociada cambia a `activa`.","operationId":"update_payment_v1_pagos__pid__put","parameters":[{"name":"pid","in":"path","required":true,"schema":{"type":"string","title":"Pid"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PagoUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PagoOut"}}}},"404":{"description":"Pago no encontrado.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Error de validación.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}},"delete":{"tags":["pagos"],"summary":"Eliminar pago","description":"No permite eliminar pagos en estado `exitoso`.","operationId":"delete_payment_v1_pagos__pid__delete","parameters":[{"name":"pid","in":"path","required":true,"schema":{"type":"string","title":"Pid"}}],"responses":{"204":{"description":"Eliminado."},"404":{"description":"Pago no encontrado.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"409":{"description":"No se puede eliminar un pago exitoso.","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"ErrorBody":{"properties":{"code":{"type":"string","title":"Code","examples":["not_found","validation_error"]},"message":{"type":"string","title":"Message","examples":["Pago no encontrado","Payload inválido"]},"extra":{"anyOf":[{},{"type":"null"}],"title":"Extra","description":"Detalles adicionales (opcional)"}},"type":"object","required":["code","message"],"title":"ErrorBody"},"ErrorResponse":{"properties":{"error":{"$ref":"#/components/schemas/ErrorBody"}},"type":"object","required":["error"],"title":"ErrorResponse"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"PagoCreate":{"properties":{"suscripcion_id":{"type":"string","title":"Suscripcion Id","description":"ID de la suscripción destino."},"monto":{"type":"number","exclusiveMinimum":0.0,"title":"Monto","description":"Monto a cobrar."},"metodo":{"type":"string","enum":["tarjeta","transferencia","stripe_simulado"],"title":"Metodo","description":"Medio de pago simulado."}},"type":"object","required":["suscripcion_id","monto","metodo"],"title":"PagoCreate","examples":[{"metodo":"stripe_simulado","monto":9.99,"suscripcion_id":"uuid-de-suscripcion"}]},"PagoOut":{"properties":{"id":{"type":"string","title":"Id"},"suscripcion_id":{"type":"string","title":"Suscripcion Id"},"monto":{"type":"number","title":"Monto"},"metodo":{"type":"string","enum":["tarjeta","transferencia","stripe_simulado"],"title":"Metodo"},"estado":{"type":"string","enum":["creado","procesando","exitoso","fallido","reembolsado"],"title":"Estado"},"provider_ref":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Provider Ref","description":"Referencia del proveedor (mock)."}},"type":"object","required":["id","suscripcion_id","monto","metodo","estado"],"title":"PagoOut"},"PagoUpdate":{"properties":{"estado":{"anyOf":[{"type":"string","enum":["creado","procesando","exitoso","fallido","reembolsado"]},{"type":"null"}],"title":"Estado","description":"Nuevo estado. Si pasa a `exitoso`, la suscripción se vuelve `activa`."},"provider_ref":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Provider Ref","description":"Referencia del proveedor (mock)."}},"type":"object","title":"PagoUpdate","examples":[{"estado":"exitoso","provider_ref":"stripe_sim_123"}]},"PlanCreate":{"properties":{"nombre":{"type":"string","maxLength":50,"minLength":1,"title":"Nombre","description":"Nombre del plan (único)."},"precio":{"type":"number","exclusiveMinimum":0.0,"title":"Precio","description":"Precio en decimales (ej. 9.99)."},"duracion":{"type":"integer","exclusiveMinimum":0.0,"title":"Duracion","description":"Duración del plan en **días**."},"estado":{"type":"string","enum":["activo","inactivo"],"title":"Estado","description":"Estado operativo del plan.","default":"activo"}},"type":"object","required":["nombre","precio","duracion"],"title":"PlanCreate","examples":[{"duracion":30,"estado":"activo","nombre":"Basic","precio":9.99}]},"PlanOut":{"properties":{"nombre":{"type":"string","maxLength":50,"minLength":1,"title":"Nombre","description":"Nombre del plan (único)."},"precio":{"type":"number","exclusiveMinimum":0.0,"title":"Precio","description":"Precio en decimales (ej. 9.99)."},"duracion":{"type":"integer","exclusiveMinimum":0.0,"title":"Duracion","description":"Duración del plan en **días**."},"estado":{"type":"string","enum":["activo","inactivo"],"title":"Estado","description":"Estado operativo del plan.","default":"activo"},"id":{"type":"string","title":"Id","description":"Identificador del plan."}},"type":"object","required":["nombre","precio","duracion","id"],"title":"PlanOut","examples":[{"duracion":30,"estado":"activo","nombre":"Basic","precio":9.99}]},"PlanUpdate":{"properties":{"nombre":{"anyOf":[{"type":"string","maxLength":50,"minLength":1},{"type":"null"}],"title":"Nombre","description":"Nuevo nombre del plan."},"precio":{"anyOf":[{"type":"number","exclusiveMinimum":0.0},{"type":"null"}],"title":"Precio","description":"Nuevo precio."},"duracion":{"anyOf":[{"type":"integer","exclusiveMinimum":0.0},{"type":"null"}],"title":"Duracion","description":"Nueva duración en días."},"estado":{"anyOf":[{"type":"string","enum":["activo","inactivo"]},{"type":"null"}],"title":"Estado","description":"Nuevo estado."}},"type":"object","title":"PlanUpdate","examples":[{"duracion":30,"estado":"activo","nombre":"Basic Plus","precio":12.99}]},"SubsCreate":{"properties":{"user_id":{"type":"string","minLength":1,"title":"User Id","description":"Identificador externo del usuario (no validado aquí)."},"plan_id":{"type":"string","title":"Plan Id","description":"ID de plan existente."},"inicio_iso":{"type":"string","title":"Inicio Iso","description":"Fecha/hora de inicio en formato ISO 8601."}},"type":"object","required":["user_id","plan_id","inicio_iso"],"title":"SubsCreate","examples":[{"inicio_iso":"2025-09-11T09:00:00","plan_id":"plan_basic","user_id":"user-123"}]},"SubsOut":{"properties":{"id":{"type":"string","title":"Id"},"user_id":{"type":"string","title":"User Id"},"plan_id":{"type":"string","title":"Plan Id"},"inicio_iso":{"type":"string","title":"Inicio Iso"},"fin_iso":{"type":"string","title":"Fin Iso"},"estado":{"type":"string","enum":["pendiente","activa","expirada","cancelada"],"title":"Estado"}},"type":"object","required":["id","user_id","plan_id","inicio_iso","fin_iso","estado"],"title":"SubsOut"},"SubsUpdate":{"properties":{"plan_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Plan Id","description":"Nuevo plan para la suscripción."},"inicio_iso":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Inicio Iso","description":"Nuevo inicio ISO 8601 (recalcula fin)."},"estado":{"anyOf":[{"type":"string","enum":["pendiente","activa","expirada","cancelada"]},{"type":"null"}],"title":"Estado","description":"Estado a aplicar. En este mock **solo se permite** cambiar a `cancelada`."}},"type":"object","title":"SubsUpdate","examples":[{"estado":"cancelada","plan_id":"plan_basic"}]},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}